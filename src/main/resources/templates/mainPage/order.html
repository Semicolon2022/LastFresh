<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>라스트프레시 | 주문서</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/front/assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="/front/assets/css/cartOrder.css">
</head>
<style>
    *{
        list-style:none;
    }
</style>
<body>
<div>
    <div id="wrapper">

        <!-- 타이틀 -->
        <div id="title">
            <a class="back-icon" href="#">
                <img src="https://res.kurly.com/mobile/service/common/2006/ico_navi_back.svg?v=1">
            </a>
            <h2 style="font-weight: 500;">주문서</h2>
        </div>

        <div class="user_form">
            <!-- 주문 상품 -->
            <div class="toggleBtn">
            <h2 class="tit_section fst">주문상품</h2>
            <a class="open-icon" href="#">
                <img src="https://res.kurly.com/mobile/ico/2106/ico_drop_up.svg">
            </a>
            </div>
            <div id="itemList" class="order_goodslist">

                <!-- 주문 상품 목록 -->
                <ul class="list_product before">
                    <li class="order-wrap">
                        <div class="thumb"><img src="https://img-cf.kurly.com/shop/data/goods/1648430138239i0.jpg" alt="상품이미지"></div>
                        <div class="name">
                            <div class="inner_name">[KF365] 아보카도 200g (1개)
                                <span class="deliveryBtn"> 배달 </span>
                            </div>
                        </div>
                        <div class="ea">1개</div>

                        <div class="info_price">
                            <span class="num">
                                <span class="price" th:text="|${#numbers.formatInteger(13600, 0, 'COMMA')}|"></span>
                                <span class="myWon">원</span>
                            </span>
                        </div>

                    </li>

                    <li>
                        <div class="thumb"><img src="https://img-cf.kurly.com/shop/data/goods/1648430138239i0.jpg" alt="상품이미지"></div>
                        <div class="name">
                            <div class="inner_name">[KF365] 아보카도 200g (1개)
                                <span class="shippingBtn"> 배송 </span>
                            </div>
                        </div>
                        <div class="ea">1개</div>

                        <div class="info_price">
                            <span class="num">
                                <span class="price" th:text="|${#numbers.formatInteger(3600, 0, 'COMMA')}|"></span>
                                <span class="myWon">원</span>
                            </span>
                        </div>
                    </li>

                    <li>
                        <div class="thumb"><img src="https://img-cf.kurly.com/shop/data/goods/1648430138239i0.jpg" alt="상품이미지"></div>
                        <div class="name">
                            <div class="inner_name">[KF365] 아보카도 200g (1개)
                                <span class="pickupBtn"> 픽업 </span>
                            </div>
                        </div>
                        <div class="ea">1개</div>

                        <div class="info_price">
                            <span class="num">
                                <span class="price" th:text="|${#numbers.formatInteger(3600, 0, 'COMMA')}|"></span>
                                <span class="myWon">원</span>
                            </span>
                        </div>

                    </li>
                </ul>

                <form id="form" name="frmOrder" action="#" method="post" onsubmit="" class="order_view" novalidate="">
                    <!-- 구매자 정보 -->
                    <div class="toggleBtn" >
                        <h2 class="tit_section">주문자 정보</h2>
                            <a class="open-icon" href="#">
                                <img src="https://res.kurly.com/mobile/ico/2106/ico_drop_up.svg">
                            </a>
                    </div>
                    <div class="order_section data_orderer before">
                        <table class="goodsinfo_table orderer">
                            <tbody><tr class="fst">
                                <th>보내는 분</th>
                                <td><input type="text" name="orderer_name" value="" required="" label="보내는 분의 이름을 적어주세요" placeholder="이름을 입력해주세요"></td>
                            </tr>
                            <tr>
                                <th>휴대폰</th>
                                <td><input type="text" name="orderer_phone" value="" size="11" maxlength="11" option="regNum" required="" label="주문자 휴대폰번호" placeholder="숫자만 입력해주세요"></td>
                            </tr>
                            <tr>
                                <th>이메일</th>
                                <td><input type="text" id="email" name="orderer_email" value="" required="" option="regEmail" label="주문자 이메일" placeholder="예) lastfresh@gmail.com"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>


                    <!-- 배송지 -->
                    <div id="deliveryInformation">
                        <div class="toggleBtn">
                            <h2 class="tit_section" id="divAddressWrapper">배송 정보</h2>
                            <a class="open-icon" href="#">
                                <img src="https://res.kurly.com/mobile/ico/2106/ico_drop_up.svg">
                            </a>
                        </div>
                        <div class="order_section order_address before">
                            <h3 href="#none" class="section_crux">배송지</h3>
                            <div class="section_full">
                            <span class="address" id="divDestination">
                               <div style="display: flex;">
                                  <input class="addBox" type="text" name="userZipcode" id="zipcode" placeholder="우편번호" style="margin-top: 0px">
                                  <input type="button" onclick="find()" value="우편번호 찾기" class="addressFinder addBox" style="margin-top: 0px"><br>
                               </div>
                                <input class="addBox" type="text" name="userAddress" id="address" placeholder="주소">
                                <input class="addBox" type="text" name="userAddressDetail" id="addressDetail" placeholder="상세주소" style="margin-top: 1px">
                            </span>
                            </div>
                        </div>
                    </div>


                    <!-- 결제 금액 회색 박스 -->
                    <div class="tax_absolute">
                        <div class="inner_sticky" id="sticky">
                            <h2 class="tit_section">결제금액</h2>
                            <div id="orderitem_money_info">
                                <dl class="amount fst">
                                    <dt class="tit">주문금액</dt>
                                    <dd class="totalPrice">
                                        <span id="productsTotalPrice">
                                        </span>
                                        <span> 원</span></dd>

                                </dl>
                                <!--
                                <dl class="amount sub">
                                    <dt class="tit">상품금액</dt>
                                    <dd class="price"><span id="paper_goodsprice" th:text="|${#numbers.formatInteger(10000, 0, 'COMMA')}|"></span><span> 원</span></dd>
                                </dl>

                                <dl class="amount sub">
                                    <dt class="tit">상품할인금액</dt>
                                    <dd class="price sales_area"><span id="special_discount_amount" th:text="|${#numbers.formatInteger(10000, 0, 'COMMA')}원|"></span></dd>

                                </dl>
                                -->
                                <dl class="amount lst">
                                    <dt class="tit">최종결제금액</dt>
                                    <dd class="totalPrice">
                                        <span id="paper_settlement">
                                        </span>
                                        <span> 원</span>
                                        <input type="hidden" value="" id="finalPrice" name="finalPrice">
                                    </dd>

                                </dl>
                            </div>
                        </div>
                    </div>

                    <!-- 결제 수단 -->
                    <div class="data_method">
                        <div class="toggleBtn">
                            <h2 class="tit_section" id="titFocusMethod">결제 수단</h2>
                            <a class="open-icon" href="#">
                                <img src="https://res.kurly.com/mobile/ico/2106/ico_drop_up.svg">
                            </a>
                        </div>
                        <table class="goodsinfo_table tbl_left before">
                            <tbody>
                            <tr>
                                <th style="margin-top: 10px;">결제수단 선택</th>
                                <td>
                                    <div class="radio-group" Style="margin: 13px 0;">
                                        <input type="radio" id="card" name="selector"><label for="card" class="myLabel">신용카드</label>
                                        <input type="radio" id="bank" name="selector"><label for="bank" class="myLabel">실시간 계좌이체</label>
                                        <input type="radio" id="phone" name="selector"><label for="phone" class="myLabel">휴대폰</label>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="txt_notice" colspan="2">
                                    <ul><li class ="noticeLi">※ 고객님은 안전거래를 위해 현금 등으로 결제시 구매안전(에스크로) 서비스를 이용하실 수 있습니다.</li></ul>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="tax_absoluteMedia" >
                        <div class="inner_sticky" id="sticky">
                            <h2 class="tit_section">결제금액</h2>
                            <div id="orderitem_money_info">
                                <dl class="amount fst">
                                    <dt class="tit">주문금액</dt>
                                    <dd class="totalPrice">
                                        <span id="productsTotalPrice">20,800</span>
                                        <span> 원</span></dd>

                                </dl>
                                <!--
                                <dl class="amount sub">
                                    <dt class="tit">상품금액</dt>
                                    <dd class="price"><span id="paper_goodsprice" th:text="|${#numbers.formatInteger(10000, 0, 'COMMA')}|"></span><span> 원</span></dd>
                                </dl>

                                <dl class="amount sub">
                                    <dt class="tit">상품할인금액</dt>
                                    <dd class="price sales_area"><span id="special_discount_amount" th:text="|${#numbers.formatInteger(10000, 0, 'COMMA')}원|"></span></dd>

                                </dl>
                                -->
                                <dl class="amount lst">
                                    <dt class="tit">최종결제금액</dt>
                                    <dd class="totalPrice">
                                        <span id="paper_settlement">20,800</span>
                                        <span> 원</span>
                                        <input type="hidden" value="20800" id="finalPrice" name="finalPrice">
                                    </dd>

                                </dl>
                            </div>
                        </div>
                    </div>
                    <!-- 버튼 -->
                    <div style="clear:both;"></div>
                    <div class="buyBtn" style="text-align: center; margin: 0 auto; font-size:15px">
                        <input type="submit" value="결제하기" class="btn_payment">
                    </div>
                </form>

                <ul class="notice_order">
                    <li>[준비중] 이전까지 주문 취소 가능합니다.</li>
                    <li>미성년자가 결제 시 법정대리인이 그 거래를 취소할 수 있습니다.</li>
                    <li>상품 미배송 시, 결제하신 수단으로 환불됩니다.</li>
                </ul><br><br>
            </div>
        </div>
    </div>
</div>

</body>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    var width = 500; //팝업의 너비
    var height = 600; //팝업의 높이

    // 주소 찾기(Daum API)
    function find() {
        new daum.Postcode({
            width: width, //생성자에 크기 값을 명시적으로 지정
            height: height,
            oncomplete: function (data) {
                var addr = ''; // 주소 변수
                if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                    addr = data.roadAddress;
                } else { // 사용자가 지번 주소를 선택했을 경우(J)
                    addr = data.jibunAddress;
                }
                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                document.getElementById('zipcode').value = data.zonecode;
                document.getElementById("address").value = addr;
                // 커서를 상세주소 필드로 이동한다.
                document.getElementById("addressDetail").focus();
            }
        }).open({
            left: (window.screen.width / 2) - (width / 2),
            top: (window.screen.height / 2) - (height / 2)
        });
    }

    var sum = 0;

    //최종 결제 금액을 계산하는 function
    function doSum() {
        $('.price').each(function () {
            console.log($(this).text());
            sum += parseInt($(this).text().replace(",", ""));
        });
        console.log("my Sum : " + sum);

        $('#productsTotalPrice').text(sum.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ','));
        $('#paper_settlement').text(sum.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ','));
        $('#finalPrice').val(sum);

    }

    $(document).ready(function() {
        doSum();
    });


    let $openIcon = $('.open-icon');
    let $before = $('.before');

    $openIcon.each(function (i, e) {
        $(e).click(function () {
            $($before[i]).slideToggle("slow");
        });
    });
</script>
</html>
